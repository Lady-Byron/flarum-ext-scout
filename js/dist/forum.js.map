{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@clarkwinkelmann/scout/webpack/bootstrap","webpack://@clarkwinkelmann/scout/webpack/runtime/compat get default export","webpack://@clarkwinkelmann/scout/webpack/runtime/define property getters","webpack://@clarkwinkelmann/scout/webpack/runtime/hasOwnProperty shorthand","webpack://@clarkwinkelmann/scout/external root \"flarum.core.compat['forum/app']\"","webpack://@clarkwinkelmann/scout/external root \"flarum.core.compat['common/extend']\"","webpack://@clarkwinkelmann/scout/external root \"flarum.core.compat['forum/components/DiscussionsSearchSource']\"","webpack://@clarkwinkelmann/scout/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@clarkwinkelmann/scout/external root \"flarum.core.compat['common/components/Link']\"","webpack://@clarkwinkelmann/scout/external root \"flarum.core.compat['common/helpers/highlight']\"","webpack://@clarkwinkelmann/scout/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionsSearchSource'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Link'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/highlight'];","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport DiscussionsSearchSource from 'flarum/forum/components/DiscussionsSearchSource';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport Link from 'flarum/common/components/Link';\nimport highlight from 'flarum/common/helpers/highlight';\nimport type Mithril from 'mithril';\n\napp.initializers.add('lady-byron-scout', () => {\n  // 扩展搜索下拉菜单中讨论结果的渲染\n  extend(\n    DiscussionsSearchSource.prototype,\n    'view',\n    function (this: DiscussionsSearchSource, vdom: Mithril.Vnode[], query: string) {\n      if (!Array.isArray(vdom)) return;\n\n      const results = this.results.get(query.toLowerCase()) || [];\n      if (!results.length) return;\n\n      vdom.forEach((vnode: any) => {\n        const dataIndex = vnode?.attrs?.['data-index'];\n        if (!dataIndex || typeof dataIndex !== 'string') return;\n        if (!dataIndex.startsWith('discussions')) return;\n\n        const discussionId = dataIndex.replace('discussions', '');\n        const discussion = results.find((d: any) => String(d.id()) === discussionId);\n        if (!discussion) return;\n\n        const titleHighlight = discussion.attribute('titleHighlight');\n        const contentHighlight = discussion.attribute('contentHighlight');\n        const mostRelevantPost = discussion.mostRelevantPost?.();\n\n        const titleContent: Mithril.Children = titleHighlight\n          ? m.trust(titleHighlight)\n          : highlight(discussion.title() || '', query);\n\n        let excerptContent: Mithril.Children = null;\n        if (contentHighlight) {\n          excerptContent = m.trust(contentHighlight);\n        } else if (mostRelevantPost) {\n          const plain = mostRelevantPost.contentPlain?.();\n          if (plain) excerptContent = highlight(plain, query, 100);\n        }\n\n        const postNumber = mostRelevantPost?.number?.();\n        const href = app.route.discussion(discussion, postNumber);\n\n        vnode.children = [\n          m(\n            Link,\n            { href },\n            [\n              m('div', { className: 'DiscussionSearchResult-title' }, titleContent),\n              excerptContent ? m('div', { className: 'DiscussionSearchResult-excerpt' }, excerptContent) : null,\n            ].filter(Boolean)\n          ),\n        ];\n      });\n    }\n  );\n\n  // 扩展讨论列表页面的高亮显示（搜索结果页）\n  extend(DiscussionListItem.prototype, 'view', function (this: DiscussionListItem, vdom: Mithril.Vnode) {\n    const discussion = this.attrs.discussion;\n    if (!discussion) return;\n\n    const titleHighlight = discussion.attribute('titleHighlight');\n    const contentHighlight = discussion.attribute('contentHighlight');\n\n    if (!titleHighlight && !contentHighlight) return;\n\n    const replaceHighlights = (node: any): void => {\n      if (!node || typeof node !== 'object') return;\n\n      const cls = node.attrs?.className || node.attrs?.class || '';\n      if (typeof cls === 'string') {\n        // 替换标题\n        if (cls.includes('DiscussionListItem-title') && titleHighlight) {\n          node.children = [m.trust(titleHighlight)];\n          return;\n        }\n        // 替换正文摘要\n        if (cls.includes('item-excerpt') && contentHighlight) {\n          node.children = [m.trust(contentHighlight)];\n          return;\n        }\n      }\n\n      if (Array.isArray(node.children)) {\n        node.children.forEach(replaceHighlights);\n      } else if (node.children) {\n        replaceHighlights(node.children);\n      }\n    };\n\n    replaceHighlights(vdom);\n  });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","app","add","extend","DiscussionsSearchSource","vdom","query","Array","isArray","results","this","toLowerCase","length","forEach","vnode","_vnode$attrs","dataIndex","attrs","startsWith","discussionId","replace","discussion","find","String","id","titleHighlight","attribute","contentHighlight","mostRelevantPost","titleContent","m","trust","highlight","title","excerptContent","plain","contentPlain","postNumber","number","href","children","Link","className","filter","Boolean","DiscussionListItem","replaceHighlights","node","_node$attrs","_node$attrs2","cls","includes"],"ignoreList":[],"sourceRoot":""}